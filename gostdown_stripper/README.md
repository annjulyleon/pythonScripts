# Markdown stripper

Скрипт разработан для использования вместе с [Gostdown](https://gitlab.iaaras.ru/iaaras/gostdown) скриптом для конвертации файлов .md в красивый .docx по ГОСТ. 
Скрипт удаляет теги, которые нужны для работы Gostdown (ссылки на рисунки, таблицы, названия таблиц), так что .md файлы можно использовать для сборки каким-нибудь статическим генератором (например, mkdocs), и не нужно ничего удалять вручную.

Папка `docs` в репозитории содержит тестовые файлы с тегами Gostdown.

Алгоритм программы:

1. Скопировать директорию с файлами из `source` в `destination`. Можно задать список (маски, названия файлов, расширения) игнорируемых при копировании файлов.
2. Для каждого из файлов .md в `destination` применить стрипперы по регулярному выражению. Список регулярных выражений и на что их заменять указан в коде, в переменной `PATTERNS` в виде списка. Если необходимо убирать какие-то еще паттерны, нужно просто добавить их в список по шаблону (`pattern` - регулярное выражение, `replace` - чем заменять). Пример списка:
```
PATTERNS = [
    {"pattern": "{#(fig|tbl|sec):.+?(?=})}", "replace": "", "desc": "caption"},
    {"pattern": "\[-@(fig|tbl|sec):.+?(?=])]", "replace": "ниже ", "desc": "reference"},
    {"pattern": "{.+?(?=})}", "replace": "", "desc": "custom style"},
    {"pattern": "# \[(.+?(?=\]))\]", "replace": r"# \1", "desc": "headings brackets"}
]
```
3. Перезаписать обработанный файл в `destination`.

По умолчанию удаляет паттерны Gostdown (названия и ссылки на рисунки (`{#fig}`,`[-@fig:]`), таблицы (`{#tab}`,`[-@tab:]`), стили из заголовков `{custom-style}`, `{.unordered}`, также удаляется брекеты `[]` из названий разделов. 
Не трогает: синтаксис в названии Приложения (её руками нужно будет удалить), и ссылки на литературу (`[@litbib]`), так как это универсальный формат, обрабатывается нормально mkdocs.

## Запуск

Запуск: из директории, в которой находится директория с файлами. Например:

```
img
docs <- md файлы тут
stripper.py
build.bat
..... any other files
```

Команда для вывода хэлпа:
```
# Выводит хелп
python .\stripper.py --help
```

Полная команда запуска в общем случае:

```
python .\stripper.py -s docs -d docs_stripped -i -i *.png *.bat *.ps1 *.lua end.md begin.md
```

* `-s`, `--source` - директория, которую копируем
* `-d`, `--destination` - название директории, куда копируем
* `-i`, `--ignored` - список игнорируемых файлов и расширения, передаются списком через пробел
